#!/usr/bin/env node

/**
 * Quality Gates Runner
 * 
 * Runs comprehensive quality gates on staged files only.
 * This script is automatically generated by CAWS scaffold.
 * 
 * @author @darianrosebrook
 */

const { runQualityGates } = require('@paths.design/caws-cli/src/utils/quality-gates');

// Parse command line arguments
const args = process.argv.slice(2);
const options = {
  languages: ['rust'],
  checkTodos: true,
  checkGodObjects: true,
  ci: args.includes('--ci') || args.includes('--ci-mode')
};

// Extract languages from arguments
const langIndex = args.indexOf('--languages');
if (langIndex !== -1 && args[langIndex + 1]) {
  options.languages = args[langIndex + 1].split(',').map(lang => lang.trim());
}

// Check for disable flags
if (args.includes('--no-todos')) {
  options.checkTodos = false;
}

if (args.includes('--no-god-objects')) {
  options.checkGodObjects = false;
}

// Run quality gates
try {
  const results = runQualityGates(options);
  
  if (!results.passed && options.ci) {
    process.exit(1);
  }
} catch (error) {
  console.error(`‚ùå Quality gates failed: ${error.message}`);
  if (options.ci) {
    process.exit(1);
  }
}
